<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
  </head>

  <body class="text-center">
    <header class="flex">
      <h1>{{ APP NAME }}</h1>
    </header>
    <div class="container">
      <div class="color-picker">
        <img src="color.png" alt="Color Picker">
        <div class="inner-picker"></div>
      </div>

      <form method="get">
        <input type="number" name="red" class="red" hidden>
        <input type="number" name="green" class="green" hidden>
        <input type="number" name="blue" class="blue" hidden>
        <input type="range" name="brightness" min="0" max="255" class="slider">
        <br />
        <button type="submit" class="btn">Apply</button>
      </form>
    </div>

    <footer>
      <form method="get">
        <input type="text" name="power" hidden>
        <button type="submit" class="power">I</button>
      </form>
    </footer>

    <script>
      window.addEventListener("load", () => {
        registerServiceWorker();
      })

      function registerServiceWorker() {
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('/sw.js').then(reg => {
            console.log('Service Worker registered successfully');
          })
            .catch(e => console.error('Error during service worker registration:', e));
        } else {
          console.warn('Service Worker is not supported');
        }
      }

    </script>

    <script>
      const getSpectrumWrapper = () => document.querySelector(".color-picker");

      const spectrumRanges = [
        { from: [255, 0, 0], to: [255, 255, 0] },
        { from: [255, 255, 0], to: [0, 255, 0] },
        { from: [0, 255, 0], to: [0, 255, 255] },
        { from: [0, 255, 255], to: [0, 0, 255] },
        { from: [0, 0, 255], to: [255, 0, 255] },
        { from: [255, 0, 255], to: [255, 0, 0] }
      ];

      const findColorValue = (from, to, leftRatio) => {
        return Math.round(from + (to - from) * leftRatio);
      };

      const findRgbFromMousePosition = (event) => {
        const wrapper = getSpectrumWrapper();
        const { clientX } = event;
        const { left, width } = wrapper.getBoundingClientRect();
        const leftDistance = Math.min(Math.max(clientX - left, 0), width - 1);
        const totalRanges = spectrumRanges.length;
        const rangeWidth = width / totalRanges;
        const includedRange = Math.floor(leftDistance / rangeWidth);
        const leftRatio = ((leftDistance % rangeWidth) / rangeWidth).toFixed(2);
        const { from, to } = spectrumRanges[includedRange];
        return {
          r: findColorValue(from[0], to[0], leftRatio),
          g: findColorValue(from[1], to[1], leftRatio),
          b: findColorValue(from[2], to[2], leftRatio)
        };
      };

      getSpectrumWrapper().addEventListener("mousemove", (e) => {
        const { r, g, b } = findRgbFromMousePosition(e);
        document.querySelector(".red").value = r;
        document.querySelector(".green").value = g;
        document.querySelector(".blue").value = b;
        document.querySelector(".inner-picker").style.backgroundColor = `rgb(${r}, ${g}, ${b}`
      });

    </script>
  </body>

</html>